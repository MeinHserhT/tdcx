<script>
  (function () {
    "use strict";
    var $;
    function init() {
      if (typeof jQuery !== "undefined") {
        $ = jQuery;
        bindToAjax();
      } else {
        setTimeout(init, 500);
      }
    }

    function bindToAjax() {
      $(document).on("ajax:success", function (evt, data, status, xhr) {
        dataLayer.push({
          event: "formAjaxSuccess",
          attributes: {
            url: xhr.url || "",
            statusCode: xhr.status || "",
            statusText: xhr.statusText || "",
            response: data || "",
          },
        });
      });
    }
    init();
  })();
</script>

<script>
  var onElmClick = function (e, f) {
      document.addEventListener("click", function (n) {
        n.target.matches(e) && f(n);
      });
    },
    btn = null;
  onElmClick("#popupBaoGia .btn", function (e) {
    setTimeout(function () {
      var element = document.querySelector(".gh-alert-content .msg");
      if (!element) {
        btn = e.target;

        var parent = btn.closest(".box-car") || btn.closest(".container");
        if (parent) {
          var ph = parent.querySelector("[id*=txtDienThoai]").value;
          ph &&
            dataLayer.push({
              event: "gui_form",
              phone: "+84" + ph.replace(/^0|^(84)0*|^(\+84)0*|\D+/g, ""),
            });
        }
      }
    }, 500);
  });
</script>
